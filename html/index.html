<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Surveyor AI</title>
  <link rel="stylesheet" href="css/styles.css" />
</head>
<body>

<div class="app">
  <!-- Sidebar -->
  <div class="card side">
    <div class="sideTop">
      <div class="brand">
        <div class="logo"></div>
        <div class="title">
          <b>Surveyor AI</b>
          <span id="userEmail">@burakustuner.com</span>
        </div>
      </div>
      <button class="iconBtn" id="openSettings" title="Ayarlar">âš™ï¸</button>
    </div>

    <!-- Auth Section -->
    <div class="sideBody" id="authSection" style="border-bottom: 1px solid var(--border); padding: 14px; padding-bottom: 14px; margin-bottom: 10px; overflow: visible; min-height: auto;">
      <div id="loginSection">
        <button class="primary" id="googleSignIn" type="button" style="width: 100%;">ğŸ” Google ile GiriÅŸ</button>
        <div class="smallMuted" style="margin-top: 6px; text-align: center; font-size: 0.75rem;">API kullanÄ±mÄ± iÃ§in giriÅŸ gerekli</div>
      </div>
      <div id="userSection" style="display: none;">
        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
          <img id="userPicture" src="" style="width: 28px; height: 28px; border-radius: 50%; border: 1px solid var(--border); flex-shrink: 0;" />
          <div style="flex: 1; min-width: 0;">
            <div style="font-weight: 600; font-size: 0.85rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; line-height: 1.3;" id="userName">KullanÄ±cÄ±</div>
            <div class="smallMuted" id="rateLimitInfo" style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-size: 0.7rem; line-height: 1.3; margin-top: 3px;">YÃ¼kleniyor...</div>
          </div>
        </div>
        <button class="danger" id="googleSignOut" type="button" style="width: 100%; padding: 6px 10px; font-size: 0.8rem; line-height: 1.4;">Ã‡Ä±kÄ±ÅŸ Yap</button>
      </div>
    </div>

    <div class="sideBody">
      <div class="field">
        <label>Model</label>
        <select id="model">
          <option value="">Modeller yÃ¼kleniyorâ€¦</option>
        </select>
        <div class="smallMuted" id="modelHint"></div>
      </div>

      <div class="field">
        <label>Prompt Åablonu</label>
        <select id="template"></select>
      </div>

      <div class="row">
        <div class="field">
          <label>Context (num_ctx)</label>
          <input id="ctx" type="number" min="256" max="32768" step="256" />
          <div class="pillRow"><span class="pill" id="ctxPill">ctx: -</span></div>
        </div>

        <div class="field">
          <label>Temperature</label>
          <input id="temp" type="range" min="0" max="1.5" step="0.05" />
          <div class="pillRow"><span class="pill" id="tempPill">temp: -</span></div>
        </div>
      </div>

      <div class="field">
        <label>GeÃ§miÅŸi sohbete ekle (son N mesaj)</label>
        <input id="historyLimit" type="number" min="0" max="50" step="1" />
        <div class="smallMuted">0 = sadece son soruyu gÃ¶nderir (context yok).</div>
      </div>

      <div class="field">
        <label>Streaming</label>
        <div class="pillRow">
          <button id="toggleStream" class="primary" type="button">Aktif</button>
          <span class="pill" id="streamPill">stream: on</span>
        </div>
      </div>

      <div class="btnRow">
        <button class="primary" id="newChat" type="button">+ Yeni sohbet</button>
        <button class="danger" id="clearChat" type="button">Temizle</button>
      </div>

      <div class="sectionTitle">
        <span>Sohbetler</span>
        <span class="smallMuted" id="sessCount">0</span>
      </div>

      <div class="sessions" id="sessions"></div>

    </div>
  </div>

  <!-- Main -->
  <div class="card main">
    <div class="topbar">
      <div class="status">
        <div class="line1">
          <span class="dot" id="statusDot"></span>
          <span class="title2" id="chatTitle">Yeni sohbet</span>
        </div>
        <div class="line2" id="chatSub">Enter gÃ¶nderir â€¢ Shift+Enter alt satÄ±r â€¢ Streaming aktif</div>
      </div>

      <div class="topRight">
        <span class="pill" id="topCtx">ctx: -</span>
        <span class="pill" id="topTemp">temp: -</span>
        <button class="primary" id="sendTop" type="button">GÃ¶nder</button>
      </div>
    </div>

    <div id="chat" class="chat"></div>

    <div class="composer">
      <textarea id="msg" placeholder="Mesaj yazâ€¦"></textarea>
    </div>
    <div class="hintRow">
      <span><span class="kbd">Enter</span> gÃ¶nder â€¢ <span class="kbd">Shift</span>+<span class="kbd">Enter</span> alt satÄ±r</span>
      <span id="rightHint">HazÄ±r</span>
    </div>
  </div>
</div>

<!-- Settings Modal -->
<div class="modalWrap" id="modalWrap">
  <div class="modal">
    <div class="modalTop">
      <b>Ayarlar</b>
      <button class="iconBtn" id="closeSettings" type="button">âœ•</button>
    </div>

    <div class="modalGrid">
      <div class="field">
        <label>Åablon Ä°Ã§eriÄŸi (System Prompt)</label>
        <textarea id="templateText" rows="6" placeholder="SeÃ§ili ÅŸablonun system prompt'u..."></textarea>
        <div class="smallMuted">Bu alan seÃ§ili ÅŸablonu geÃ§ici olarak override eder (sadece bu cihazda).</div>
      </div>

      <div class="field">
        <label>Yeni ÅŸablon adÄ±</label>
        <input id="newTemplateName" type="text" placeholder="Ã–rn: GIS SQL AsistanÄ±" />
      </div>

      <div class="field">
        <label>Yeni ÅŸablon System Prompt</label>
        <textarea id="newTemplateText" rows="5" placeholder="Ã–rn: TÃ¼rkÃ§e konuÅŸ. PostGIS SQL Ã¼ret..."></textarea>
      </div>

      <div class="pillRow">
        <button id="addTemplate" class="primary" type="button">Åablon ekle</button>
        <button id="deleteTemplate" class="danger" type="button">SeÃ§ili ÅŸablonu sil</button>
      </div>
    </div>

    <div class="modalActions">
      <button id="saveSettings" class="primary" type="button">Kaydet</button>
    </div>
  </div>
</div>

<!-- Google Sign-In -->
<script src="https://accounts.google.com/gsi/client" async defer></script>

<!-- JavaScript moved to js/ modules -->
<script type="module" src="js/app.js"></script>

</body>
</html>
